import { fonts } from 'modern-font'
import { render } from '../../src'

async function init(): Promise<void> {
  await fonts.loadFallbackFont({ family: 'fallbackFont', src: '/fonts/AaHouDiHei.woff' })
  await fonts.load({ family: 'LogoSCUnboundedSans-Regular', src: 'https://bige.cdn.bcebos.com/files/202212/yD93n4kN_raUm.woff' })

  const width = 1000
  const height = 1555
  const canvas = document.createElement('canvas')
  canvas.width = width
  canvas.height = height
  canvas.style.width = `${width / 2}px`
  canvas.style.height = `${height / 2}px`
  const ctx2d = canvas.getContext('2d')!
  document.body.append(canvas)

  await render({
    debug: true,
    width,
    height,
    data: { style: { width: 1000, height: 1555 }, children: [{ name: 'Frame 1', id: '5xLmsMl2Pf', children: [{ name: '形状 1', id: 'fPvqGx653O', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'APZT1TaHnP', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-y3frqq5wyk', category: 'in', timing: 'start', el: 'bi-pu2bx8ans', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 907, height: 470, left: 43, top: 172, right: 950, bottom: 642, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/4.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: '形状 2', id: 'K4wGes8Dln', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'stb4Vx9En3', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-it0mlqattr', category: 'in', timing: 'start', el: 'bi-avu4wmqkt9', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 210, height: 50, left: 187, top: 204, right: 397, bottom: 254, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/5.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: '形状 3', id: 'vasQtGxV5d', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'Jj_HxkN-Za', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-uegpnvo7f', category: 'in', timing: 'start', el: 'bi-vs4ygmirlw', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 207, height: 111, left: 736, top: 516, right: 943, bottom: 627, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/6.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: 'bi-spqgco1o7', id: 'lqte9eE7T8', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'LT2qlfJs6h', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-41laiu39ac', category: 'in', timing: 'start', el: 'bi-spqgco1o7', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Shape', inEditorIs: 'Element', lock: false }, style: { width: 659.2105263157894, height: 118.42105263157893, left: 259, top: 484.9999999999999, right: 425, bottom: 408, padding: 0, textAlign: 'left', textIndent: '', lineHeight: 1, color: '#000000ff', letterSpacing: 2, fontSize: 120, fontWeight: 400, fontFamily: 'LogoSCUnboundedSans-Regular' }, text: { content: [{ fragments: [{ content: '完美落幕' }] }], drawMode: 'texture' } }, { name: 'bi-vmllu3407i', id: 'OesV7Y-khU', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'uV9aT8K_q5', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-r99ywx561', category: 'in', timing: 'start', el: 'bi-vmllu3407i', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Shape', inEditorIs: 'Element', lock: false }, style: { width: 701, height: 100, left: 196.9736842105262, top: 254, right: 808, bottom: 565, padding: 0, textAlign: 'center', textIndent: '', lineHeight: 1, color: '#000000ff', letterSpacing: 2, fontSize: 100, fontWeight: 400, fontFamily: 'LogoSCUnboundedSans-Regular' }, text: { content: [{ fragments: [{ content: '泰康金融大厦' }] }], drawMode: 'texture' } }, { name: 'bi-s01jfu1li9', id: 'wLLlFKJIrU', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'i6pbp-soYX', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-skv3rhndct', category: 'in', timing: 'start', el: 'bi-s01jfu1li9', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Shape', inEditorIs: 'Element', lock: false }, style: { width: 836, height: 100, left: 83.00000000000011, top: 370.97368421052647, right: 891, bottom: 413, padding: 0, textAlign: 'left', textIndent: '', lineHeight: 1, color: '#626efaff', letterSpacing: 2, fontSize: 100, fontWeight: 400, fontFamily: 'LogoSCUnboundedSans-Regular' }, text: { content: [{ fragments: [{ content: '×海免美妆内购会' }] }], drawMode: 'texture' } }, { name: 'bigetk_40789', id: '-o8JDMz-hn', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'fmDri0hWdh', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-q9muqzwqma', category: 'in', timing: 'start', el: 'bi-hq0j5qnwl7', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 597, height: 632, left: 143.13157894736855, top: 718.0315789473683, right: 782, bottom: 1248, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/9.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: 'bigetk_40789', id: 'fPx_WUsHiL', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'wPppJ_GmUY', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-a1iaq1uv6r', category: 'in', timing: 'start', el: 'bi-7llf4hkpfq', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 122, height: 130, left: 808.0000000000002, top: 136.36842105263167, right: 145, bottom: 594, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/10.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: '多边形 1', id: 'fHrFo_wGOm', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'BVzCI0d5__', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-nazs8w7mz', category: 'in', timing: 'start', el: 'bi-1fp7yduzsr', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 71, height: 70, left: 81, top: 639, right: 152, bottom: 709, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/11.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: '多边形 1 拷贝', id: 'ctVGa5Wquw', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'jPulT-qe0n', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-uej0qunzmj', category: 'in', timing: 'start', el: 'bi-99lavyjrzi', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 71, height: 70, left: 826.9736842105261, top: 344.6578947368425, right: 990, bottom: 457, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/11.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: 'bigetk_51053', id: 'l4guWYWlA9', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'VfgqmSaHGB', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-uqb692pcww', category: 'in', timing: 'start', el: 'bi-67t2kly0c', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 202, height: 193, left: 40.8, top: 1233.8315789473688, right: 238, bottom: 1099, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/14.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: 'bigetk_39887', id: 'trWSyCKCND', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'n7GgjdnPiO', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-3mjbby7jq', category: 'in', timing: 'start', el: 'bi-qgvrscdf0a', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 258.4473684210518, height: 239.98684210526244, left: 740.1315789473683, top: 988.618421052632, right: 973, bottom: 1116, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/15.png', cropRect: { left: 0, top: 5.921514109081394e-17, right: 0, bottom: 1.1843028218162787e-16 }, fillWithShape: true } }, { name: '矩形 3 拷贝', id: 'D-xnKhNCRp', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'M7FiTCgryy', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-6g0c17e24b', category: 'in', timing: 'start', el: 'bi-6l00ty73qh', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 820, height: 94, left: 126, top: 1594, right: 946, bottom: 1688, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/17.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: '形状 4 拷贝', id: 'VYEF7WPT-g', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'kySFfSnBEl', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-vdiw3jiahs', category: 'in', timing: 'start', el: 'bi-79rw7s98vq', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 56, height: 32, left: 808, top: 1682, right: 864, bottom: 1714, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/18.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: '矩形 3 拷贝 2', id: 'vhGIjeorvR', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: '2BCoE2w1E-', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-ib8thzrheq', category: 'in', timing: 'start', el: 'bi-bvbnxrsws', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 662, height: 94, left: 49, top: 1722, right: 711, bottom: 1816, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/20.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: '形状 4 拷贝 2', id: 'ErbhP6bqMY', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'PiJ3FVZreD', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-v52i7a8nja', category: 'in', timing: 'start', el: 'bi-j5mblya9rh', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: false }, style: { width: 56, height: 32, left: 139, top: 1809, right: 195, bottom: 1841, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/designs/files/2888470/251015_qjxfkb/18.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }, { name: 'bi-47avmfn9g5', id: 'gQ8-ocd2QA', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: '15TyTcFeLs', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-2o5b0zaf4', category: 'in', timing: 'start', el: 'bi-47avmfn9g5', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Shape', inEditorIs: 'Element', lock: false }, style: { width: 556, height: 45, left: 118, top: 1743, right: 623, bottom: 1791, textAlign: 'left', textIndent: '', lineHeight: 1, color: '#000000ff', letterSpacing: 2, fontSize: 45, fontWeight: 400, fontFamily: 'SourceHanSansCN-Bold' }, text: { content: [{ fragments: [{ id: 0, content: '全' }, { id: 1, content: '场' }, { id: 2, content: '折' }, { id: 3, content: '学' }, { id: 4, content: '家' }, { id: 5, content: '·' }, { id: 6, content: '消' }, { id: 7, content: '费' }, { id: 8, content: '抽' }, { id: 9, content: '免' }, { id: 10, content: '单' }] }], drawMode: 'texture' } }, { name: 'bi-y5xoddioz5', id: '3ZCICuIYAZ', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'pNO0uDMzMf', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-sx4i1jt1ad', category: 'in', timing: 'start', el: 'bi-y5xoddioz5', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Shape', inEditorIs: 'Element', lock: false }, style: { width: 768, height: 45, left: 166, top: 1618, right: 900, bottom: 1666, textAlign: 'left', textIndent: '', lineHeight: 1, color: '#000000ff', letterSpacing: 2, fontSize: 45, fontWeight: 400, fontFamily: 'SourceHanSansCN-Bold' }, text: { content: [{ fragments: [{ id: 0, content: '双' }, { id: 1, content: '十' }, { id: 2, content: '一' }, { id: 3, content: '购' }, { id: 4, content: '物' }, { id: 5, content: '狂' }, { id: 6, content: '欢' }, { id: 7, content: '季' }, { id: 8, content: '三' }, { id: 9, content: '重' }, { id: 10, content: '优' }, { id: 11, content: '惠' }, { id: 12, content: '来' }, { id: 13, content: '袭' }, { id: 14, content: '等' }, { id: 15, content: '你' }] }], drawMode: 'texture' } }, { name: 'logo', id: 'swtIdvxs-c', children: [{ name: '向上淡入', keyframes: [{ opacity: 0, transform: 'translate3d(0, 50%, 0)' }], id: 'P6UnTHSF0H', duration: 500, easing: 'linear', meta: { inCanvasIs: 'Animation', id: 'bi-y3b3078s7o', category: 'in', timing: 'start', el: 'bi-zg1cxdojas', inPptIs: 'Animation', inEditorIs: 'Node' } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Picture', inEditorIs: 'Element', lock: true }, style: { width: 564.9210526315787, height: 317.73964120615784, left: -74.99999999999996, top: -41.502799100894606, right: 356, bottom: 175, textAlign: 'center' }, text: { content: [] }, foreground: { image: 'https://bige.cdn.bcebos.com/users/1442451/20250928/5c4dbba4c6edea644fd00eddd96910b2.png', cropRect: { left: 0, top: 0, right: 0, bottom: 0 }, fillWithShape: true } }], meta: { inCanvasIs: 'Element2D', inPptIs: 'Slide', inEditorIs: 'Frame' }, style: { overflow: 'hidden', width: 1000, height: 1555, right: 'auto', bottom: 'auto', left: 0, top: 0, rotate: 0 }, background: { image: 'https://cdn.bigesj.com/files/202208/xhzFYAux_5sDQ.png' }, text: { content: [] } }], meta: { inPptIs: 'Pptx', inCanvasIs: 'Node2D', startTime: 0, endTime: 500 } },
    keyframes: [0, 100, 200, 300, 400, 500],
    onKeyframe: (frame, { progress }) => {
      ctx2d.putImageData(new ImageData(frame, width, height), 0, 0)
      console.warn(progress)
    },
  })
}

init()
